<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SistComanda Pro - Gestión de Restaurante</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .dark { background-color: #1a202c; color: #e2e8f0; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
    </style>
</head>
<body class="bg-gray-100 transition-colors duration-300" id="body">

    <div class="flex h-screen">
        <aside class="w-64 bg-slate-800 text-white flex flex-col">
            <div class="p-6 text-2xl font-bold border-b border-slate-700">RestoSoft v1.0</div>
            <nav class="flex-1 p-4 space-y-2">
                <button onclick="showTab('mesas')" class="w-full flex items-center p-3 hover:bg-slate-700 rounded transition"><i class="fas fa-utensils mr-3"></i> Mesas</button>
                <button onclick="showTab('cocina')" class="w-full flex items-center p-3 hover:bg-slate-700 rounded transition"><i class="fas fa-fire mr-3"></i> Cocina</button>
                <button onclick="showTab('caja')" class="w-full flex items-center p-3 hover:bg-slate-700 rounded transition"><i class="fas fa-cash-register mr-3"></i> Caja</button>
                <button onclick="showTab('config')" class="w-full flex items-center p-3 hover:bg-slate-700 rounded transition"><i class="fas fa-cog mr-3"></i> Configuración</button>
            </nav>
            <div class="p-4 border-t border-slate-700">
                <button onclick="toggleDarkMode()" class="w-full p-2 bg-slate-600 rounded">Modo Oscuro</button>
            </div>
        </aside>

        <main class="flex-1 p-8 overflow-y-auto">
            
            <section id="mesas" class="tab-content active">
                <h2 class="text-3xl font-bold mb-6">Mapa de Mesas</h2>
                <div id="grid-mesas" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-6">
                    </div>
            </section>

            <section id="cocina" class="tab-content">
                <h2 class="text-3xl font-bold mb-6">Monitor de Cocina</h2>
                <div id="lista-comandas" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    </div>
            </section>

            <section id="caja" class="tab-content">
                <h2 class="text-3xl font-bold mb-6">Caja y Facturación</h2>
                <div id="lista-caja" class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-lg">
                    </div>
            </section>

            <section id="config" class="tab-content">
                <h2 class="text-3xl font-bold mb-6">Configuración del Sistema</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div class="bg-white dark:bg-gray-800 p-6 rounded shadow">
                        <h3 class="font-bold mb-4 border-b">Ajustes Generales</h3>
                        <label class="block mb-2">Tasa del Dólar (Bs/USD)</label>
                        <input type="number" id="tasa-cambio" value="35.50" class="w-full p-2 border rounded dark:bg-gray-700 mb-4">
                        <label class="block mb-2">Cantidad de Mesas</label>
                        <input type="number" id="num-mesas" value="12" class="w-full p-2 border rounded dark:bg-gray-700">
                        <button onclick="saveGeneralConfig()" class="mt-4 bg-blue-600 text-white px-4 py-2 rounded">Guardar Cambios</button>
                    </div>
                    <div class="bg-white dark:bg-gray-800 p-6 rounded shadow">
                        <h3 class="font-bold mb-4 border-b">Agregar Platillo</h3>
                        <input type="text" id="p-nombre" placeholder="Nombre Platillo" class="w-full p-2 border rounded mb-2 dark:bg-gray-700">
                        <input type="number" id="p-precio" placeholder="Precio USD" class="w-full p-2 border rounded mb-4 dark:bg-gray-700">
                        <button onclick="addDish()" class="bg-green-600 text-white px-4 py-2 rounded w-full">Agregar al Menú</button>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <div id="modal-pedido" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center">
        <div class="bg-white dark:bg-gray-800 p-8 rounded-lg w-11/12 max-w-2xl">
            <h3 id="modal-titulo" class="text-2xl font-bold mb-4">Mesa #</h3>
            <div id="menu-items" class="grid grid-cols-2 gap-4 mb-6">
                </div>
            <div class="border-t pt-4">
                <p class="text-xl font-bold">Total: $<span id="modal-total">0.00</span></p>
                <div class="flex justify-end space-x-4 mt-6">
                    <button onclick="closeModal()" class="px-6 py-2 bg-gray-400 rounded">Cancelar</button>
                    <button onclick="enviarACocina()" class="px-6 py-2 bg-orange-600 text-white rounded">Enviar Comanda</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- ESTADO DE LA APLICACIÓN ---
        let appState = {
            tasa: 35.50,
            mesas: Array.from({length: 12}, (_, i) => ({ id: i + 1, ocupada: false, pedido: [], total: 0 })),
            menu: [
                { id: 1, nombre: "Hamburguesa Clásica", precio: 8.50 },
                { id: 2, nombre: "Pizza Margarita", precio: 12.00 },
                { id: 3, nombre: "Refresco", precio: 2.00 }
            ],
            comandasCocina: [],
            mesaSeleccionada: null
        };

        // --- LÓGICA DE NAVEGACIÓN ---
        function showTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            renderData();
        }

        function toggleDarkMode() {
            document.getElementById('body').classList.toggle('dark');
        }

        // --- RENDERIZADO ---
        function renderData() {
            // Renderizar Mesas
            const gridMesas = document.getElementById('grid-mesas');
            gridMesas.innerHTML = '';
            appState.mesas.forEach(mesa => {
                gridMesas.innerHTML += `
                    <div onclick="openMesa(${mesa.id})" class="cursor-pointer p-6 rounded-xl shadow-md text-center ${mesa.ocupada ? 'bg-red-500 text-white' : 'bg-green-500 text-white'}">
                        <i class="fas fa-table text-3xl mb-2"></i>
                        <div class="font-bold">Mesa ${mesa.id}</div>
                        <div class="text-sm">${mesa.ocupada ? 'Ocupada - $' + mesa.total : 'Libre'}</div>
                    </div>
                `;
            });

            // Renderizar Cocina
            const listaCocina = document.getElementById('lista-comandas');
            listaCocina.innerHTML = '';
            appState.comandasCocina.forEach((comanda, index) => {
                listaCocina.innerHTML += `
                    <div class="bg-white dark:bg-gray-700 p-4 rounded-lg shadow border-l-4 border-orange-500">
                        <div class="flex justify-between font-bold border-b pb-2 mb-2">
                            <span>Mesa #${comanda.mesaId}</span>
                            <span class="text-blue-500">${comanda.status}</span>
                        </div>
                        <ul class="text-sm mb-4">
                            ${comanda.items.map(i => `<li>• ${i.nombre}</li>`).join('')}
                        </ul>
                        <div class="flex justify-between items-center">
                            <span class="text-xs text-gray-500">Enviado: ${comanda.hora}</span>
                            <button onclick="cambiarEstadoCocina(${index})" class="bg-blue-600 text-white text-xs px-2 py-1 rounded">Siguiente Paso</button>
                        </div>
                    </div>
                `;
            });

            // Renderizar Caja
            const listaCaja = document.getElementById('lista-caja');
            listaCaja.innerHTML = '<table class="w-full text-left"><thead><tr class="border-b"><th>Mesa</th><th>Total USD</th><th>Total Bs</th><th>Acción</th></tr></thead><tbody id="body-caja"></tbody></table>';
            const bodyCaja = document.getElementById('body-caja');
            appState.mesas.filter(m => m.ocupada).forEach(m => {
                bodyCaja.innerHTML += `
                    <tr class="border-b">
                        <td class="py-3">Mesa ${m.id}</td>
                        <td>$${m.total.toFixed(2)}</td>
                        <td>Bs ${(m.total * appState.tasa).toFixed(2)}</td>
                        <td><button onclick="cobrarMesa(${m.id})" class="bg-green-600 text-white px-3 py-1 rounded text-sm">Cobrar / POS</button></td>
                    </tr>
                `;
            });
        }

        // --- ACCIONES DE MESA ---
        function openMesa(id) {
            appState.mesaSeleccionada = id;
            const mesa = appState.mesas.find(m => m.id === id);
            document.getElementById('modal-titulo').innerText = `Pedido Mesa #${id}`;
            const menuDiv = document.getElementById('menu-items');
            menuDiv.innerHTML = '';
            appState.menu.forEach(item => {
                menuDiv.innerHTML += `
                    <button onclick="addItemToOrder(${item.id})" class="p-3 bg-gray-200 dark:bg-gray-600 rounded hover:bg-blue-500 hover:text-white transition text-left">
                        ${item.nombre} <br> <span class="font-bold">$${item.precio}</span>
                    </button>
                `;
            });
            updateModalTotal();
            document.getElementById('modal-pedido').style.display = 'flex';
        }

        function addItemToOrder(dishId) {
            const dish = appState.menu.find(d => d.id === dishId);
            const mesa = appState.mesas.find(m => m.id === appState.mesaSeleccionada);
            mesa.pedido.push(dish);
            mesa.total += dish.precio;
            mesa.ocupada = true;
            updateModalTotal();
            showNotification(`Agregado: ${dish.nombre}`);
        }

        function updateModalTotal() {
            const mesa = appState.mesas.find(m => m.id === appState.mesaSeleccionada);
            document.getElementById('modal-total').innerText = mesa.total.toFixed(2);
        }

        function enviarACocina() {
            const mesa = appState.mesas.find(m => m.id === appState.mesaSeleccionada);
            appState.comandasCocina.push({
                mesaId: mesa.id,
                items: [...mesa.pedido],
                status: 'En espera',
                hora: new Date().toLocaleTimeString()
            });
            closeModal();
            renderData();
            showNotification("Comanda enviada a cocina");
        }

        // --- LÓGICA DE COCINA ---
        function cambiarEstadoCocina(index) {
            const estados = ['En espera', 'En preparación', 'Listo para enviar'];
            let current = estados.indexOf(appState.comandasCocina[index].status);
            if (current < 2) {
                appState.comandasCocina[index].status = estados[current + 1];
            } else {
                appState.comandasCocina.splice(index, 1);
                showNotification("Plato retirado de cocina");
            }
            renderData();
        }

        // --- LÓGICA DE CAJA ---
        function cobrarMesa(id) {
            const mesa = appState.mesas.find(m => m.id === id);
            const totalBs = (mesa.total * appState.tasa).toFixed(2);
            
            const confirmacion = confirm(`COBRO MESA ${id}\nTotal USD: $${mesa.total}\nTotal Bs: ${totalBs}\n\n¿Desea procesar el pago y enviar factura por WhatsApp?`);
            
            if (confirmacion) {
                const mensaje = `Factura Mesa ${id}: Total $${mesa.total} (Bs ${totalBs})`;
                window.open(`https://wa.me/?text=${encodeURIComponent(mensaje)}`, '_blank');
                mesa.ocupada = false;
                mesa.pedido = [];
                mesa.total = 0;
                renderData();
            }
        }

        // --- CONFIGURACIÓN ---
        function saveGeneralConfig() {
            appState.tasa = parseFloat(document.getElementById('tasa-cambio').value);
            const num = parseInt(document.getElementById('num-mesas').value);
            appState.mesas = Array.from({length: num}, (_, i) => ({ id: i + 1, ocupada: false, pedido: [], total: 0 }));
            showNotification("Configuración actualizada");
            renderData();
        }

        function addDish() {
            const nom = document.getElementById('p-nombre').value;
            const pre = parseFloat(document.getElementById('p-precio').value);
            if(nom && pre) {
                appState.menu.push({ id: Date.now(), nombre: nom, precio: pre });
                showNotification("Platillo agregado");
                renderData();
            }
        }

        // --- UTILIDADES ---
        function closeModal() { document.getElementById('modal-pedido').style.display = 'none'; }
        
        function showNotification(msg) {
            const toast = document.createElement('div');
            toast.className = "fixed bottom-5 right-5 bg-black text-white px-6 py-3 rounded shadow-lg z-50";
            toast.innerText = msg;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }

        // Inicio
        renderData();
    </script>
</body>
</html>
