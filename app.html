<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Sushisimo - Sistema de Comandas</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --accent: #ff6b00; --bg-dark: #1a1c22; --bg-card: #252830; }
        .dark-mode { background-color: var(--bg-dark); color: white; }
        .light-mode { background-color: #f3f4f6; color: #1a1c22; }
        .accent-text { color: var(--accent); }
        .bg-accent { background-color: var(--accent); }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .mesa-lista { animation: pulse 1.5s infinite; border: 2px solid #10b981; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="dark-mode transition-colors duration-300 font-sans no-scrollbar">

    <header class="p-6 pb-2">
        <div class="flex justify-between items-center mb-4">
            <div>
                <h1 class="text-3xl font-bold tracking-tight">Sushisimo</h1>
                <p class="text-gray-400 text-sm">Bienvenido/a, <span class="text-white">Administrador</span></p>
            </div>
            <button class="bg-red-500/20 text-red-500 px-4 py-1 rounded-lg font-bold text-sm">Salir</button>
        </div>
        
        <div class="flex space-x-6 border-b border-gray-700 pb-2 mb-4 text-sm font-bold">
            <button onclick="showTab('dashboard')" class="accent-text border-b-2 border-orange-500 pb-2">Dashboard</button>
            <button onclick="showTab('config')" class="text-gray-500">Gestión de Usuarios</button>
        </div>

        <div class="flex bg-[#252830] rounded-xl p-1 mb-6">
            <button onclick="showTab('mesas')" class="flex-1 py-2 rounded-lg font-bold text-sm">Mesas</button>
            <button onclick="showTab('cocina')" class="flex-1 py-2 rounded-lg font-bold text-sm">Cocina</button>
            <button onclick="showTab('caja')" class="flex-1 py-2 rounded-lg font-bold text-sm">Caja</button>
        </div>
    </header>

    <main class="px-6 pb-24">
        
        <section id="mesas" class="tab-content active">
            <h2 class="text-lg font-bold mb-4 italic">Mesas de</h2>
            <div id="grid-mesas" class="grid grid-cols-2 gap-4">
                </div>
        </section>

        <section id="cocina" class="tab-content">
            <h2 class="text-lg font-bold mb-4">Monitor de Cocina</h2>
            <div id="lista-cocina" class="space-y-4">
                </div>
        </section>

        <section id="caja" class="tab-content">
            <h2 class="text-lg font-bold mb-4 text-center">Facturación y POS</h2>
            <div id="lista-caja" class="space-y-4"></div>
        </section>

        <section id="config" class="tab-content">
            <div class="space-y-6">
                <div class="bg-[#252830] p-4 rounded-2xl">
                    <h3 class="font-bold mb-3 accent-text text-sm uppercase">Agregar Platillo</h3>
                    <input type="text" id="new-p-nombre" placeholder="Nombre..." class="w-full bg-[#1a1c22] p-3 rounded-xl mb-2 text-sm">
                    <input type="number" id="new-p-precio" placeholder="Precio USD" class="w-full bg-[#1a1c22] p-3 rounded-xl mb-4 text-sm">
                    <button onclick="addPlatillo()" class="w-full bg-green-600 py-3 rounded-xl font-bold">Guardar Producto</button>
                </div>
                
                <div class="bg-[#252830] p-4 rounded-2xl">
                    <h3 class="font-bold mb-3 accent-text text-sm uppercase">Ajustes Generales</h3>
                    <div class="flex justify-between items-center mb-4 text-sm">
                        <span>Tasa del Dólar (Bs)</span>
                        <input type="number" id="cfg-tasa" value="36.5" class="bg-[#1a1c22] w-20 p-2 rounded text-right">
                    </div>
                    <div class="flex justify-between items-center mb-4 text-sm">
                        <span>Modo Oscuro</span>
                        <input type="checkbox" checked onchange="toggleTheme()" class="w-10 h-5 accent-orange-500">
                    </div>
                </div>
            </div>
        </section>
    </main>

    <div id="modal-pedido" class="fixed inset-0 bg-black/80 hidden z-50 flex items-end">
        <div class="bg-[#252830] w-full rounded-t-[3rem] p-8 max-h-[85vh] overflow-y-auto">
            <div class="w-12 h-1 bg-gray-600 mx-auto mb-6 rounded"></div>
            <h2 id="mesa-titulo" class="text-2xl font-bold mb-2">Mesa </h2>
            <p id="notif-cocina" class="text-green-400 text-xs font-bold mb-4 hidden italic">¡Esta mesa tiene platos listos!</p>
            
            <select id="select-platillo" class="w-full bg-[#1a1c22] p-4 rounded-2xl mb-4 border border-gray-700 text-gray-300">
                <option value="">Seleccione un platillo...</option>
            </select>
            
            <textarea placeholder="Notas (Opcional)" class="w-full bg-[#1a1c22] p-4 rounded-2xl mb-6 h-20 text-sm"></textarea>
            
            <div class="flex justify-between items-center mb-8">
                <span class="text-gray-400">Total en USD:</span>
                <span class="text-2xl font-black accent-text">$<span id="total-pedido">0.00</span></span>
            </div>

            <div class="grid grid-cols-2 gap-4">
                <button onclick="closeModal()" class="bg-gray-700 py-4 rounded-2xl font-bold uppercase text-xs">Cerrar</button>
                <button onclick="confirmarPedido()" class="bg-accent py-4 rounded-2xl font-bold uppercase text-xs shadow-lg shadow-orange-500/20">Enviar Comanda</button>
            </div>
        </div>
    </div>

    <script>
        // ESTADO INICIAL
        let app = {
            tasa: 36.5,
            mesas: Array.from({length: 8}, (_, i) => ({ id: i + 1, status: 'Libre', pedido: [], total: 0, listaParaEntrega: false })),
            menu: [
                { nombre: 'California Roll', precio: 12 },
                { nombre: 'Sashimi Atún', precio: 15 },
                { nombre: 'Mochi Té Verde', precio: 5 }
            ],
            cocina: [],
            mesaActiva: null
        };

        // NAVEGACIÓN
        function showTab(id) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            render();
        }

        // CRUD PLATILLOS
        function addPlatillo() {
            const n = document.getElementById('new-p-nombre').value;
            const p = parseFloat(document.getElementById('new-p-precio').value);
            if(n && p) {
                app.menu.push({ nombre: n, precio: p });
                alert("Platillo Agregado");
                showTab('mesas');
            }
        }

        // GESTIÓN DE MESAS
        function render() {
            // Mesas
            const grid = document.getElementById('grid-mesas');
            grid.innerHTML = app.mesas.map(m => `
                <div onclick="openMesa(${m.id})" class="p-6 rounded-2xl flex flex-col items-center justify-center transition-all active:scale-95 ${m.listaParaEntrega ? 'mesa-lista' : (m.status === 'Libre' ? 'bg-[#bbf7d0] text-black' : 'bg-[#252830] text-white border border-gray-700')}">
                    <span class="text-sm font-bold">Mesa ${m.id}</span>
                    <span class="text-[10px] opacity-70 mt-1 uppercase">${m.listaParaEntrega ? '¡LISTO!' : m.status}</span>
                </div>
            `).join('');

            // Cocina
            const listaCocina = document.getElementById('lista-cocina');
            listaCocina.innerHTML = app.cocina.map((c, i) => `
                <div class="bg-[#252830] p-5 rounded-2xl border-l-4 ${c.estado === 'En espera' ? 'border-red-500' : 'border-green-500'}">
                    <div class="flex justify-between items-start mb-2">
                        <span class="font-bold text-orange-500">Mesa ${c.mesaId}</span>
                        <span class="text-[10px] bg-black/30 px-2 py-1 rounded italic">${c.tiempo}</span>
                    </div>
                    <div class="text-sm mb-4">${c.platos.map(p => `• ${p.nombre}`).join('<br>')}</div>
                    <button onclick="avanzarCocina(${i})" class="w-full py-2 bg-green-600 rounded-xl text-xs font-bold uppercase">${c.estado === 'En espera' ? 'Marcar Preparado' : 'Listo para enviar'}</button>
                </div>
            `).join('');

            // Caja
            const listaCaja = document.getElementById('lista-caja');
            const ocupadas = app.mesas.filter(m => m.status === 'Ocupada');
            listaCaja.innerHTML = ocupadas.map(m => `
                <div class="bg-[#252830] p-5 rounded-3xl flex justify-between items-center border border-gray-800">
                    <div>
                        <div class="text-sm font-bold uppercase tracking-widest text-gray-500">Mesa ${m.id}</div>
                        <div class="text-xl font-black">$${m.total} <span class="text-xs text-green-500 ml-2">Bs ${(m.total * app.tasa).toFixed(2)}</span></div>
                    </div>
                    <button onclick="cobrar(${m.id})" class="bg-green-500 text-black px-4 py-2 rounded-xl font-bold text-xs">Cobrar / POS</button>
                </div>
            `).join('');
        }

        function openMesa(id) {
            app.mesaActiva = id;
            const mesa = app.mesas.find(m => m.id === id);
            document.getElementById('mesa-titulo').innerText = `Mesa ${id}`;
            document.getElementById('total-pedido').innerText = mesa.total.toFixed(2);
            document.getElementById('notif-cocina').style.display = mesa.listaParaEntrega ? 'block' : 'none';
            
            const select = document.getElementById('select-platillo');
            select.innerHTML = '<option value="">Seleccione un platillo...</option>' + 
                app.menu.map((p, i) => `<option value="${i}">${p.nombre} - $${p.precio}</option>`).join('');
            
            document.getElementById('modal-pedido').classList.remove('hidden');
        }

        function confirmarPedido() {
            const sel = document.getElementById('select-platillo').value;
            const mesa = app.mesas.find(m => m.id === app.mesaActiva);
            
            if(sel !== "") {
                const plato = app.menu[sel];
                mesa.pedido.push(plato);
                mesa.total += plato.precio;
                mesa.status = 'Ocupada';
                
                // Enviar a Cocina
                app.cocina.push({
                    mesaId: mesa.id,
                    platos: [plato],
                    estado: 'En espera',
                    tiempo: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})
                });
            }
            closeModal();
            render();
        }

        function avanzarCocina(i) {
            const item = app.cocina[i];
            if(item.estado === 'En espera') {
                item.estado = 'Listo';
            } else {
                // Notificar al mesero
                const mesa = app.mesas.find(m => m.id === item.mesaId);
                mesa.listaParaEntrega = true;
                app.cocina.splice(i, 1);
            }
            render();
        }

        function cobrar(id) {
            const mesa = app.mesas.find(m => m.id === id);
            const msg = `Mesa ${id} pagada: $${mesa.total}`;
            window.open(`https://wa.me/?text=${encodeURIComponent(msg)}`, '_blank');
            mesa.status = 'Libre';
            mesa.pedido = [];
            mesa.total = 0;
            mesa.listaParaEntrega = false;
            render();
        }

        function closeModal() {
            document.getElementById('modal-pedido').classList.add('hidden');
            const mesa = app.mesas.find(m => m.id === app.mesaActiva);
            mesa.listaParaEntrega = false; // El mesero "vio" la notificación
            render();
        }

        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            document.body.classList.toggle('light-mode');
        }

        // INICIO
        render();
    </script>
</body>
</html>
